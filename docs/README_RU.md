# WheelBot.org Controller Module

## Описание
Проект WheelBot Controller Module представляет собой прошивку (firmware) для колесного робота (WheelBot) на базе микроконтроллера ESP8266. Проект предназначен для автономного или дистанционного управления роботом через MQTT.

Проект Wheelbot.org - это колесный робот за 30$ с открытой архитектурой для исследования алгоритмов машинного обучения и автономных систем.

### Функции
- **Сенсорная система**: Ультразвуковые датчики (HC-SR04) для обнаружения препятствий, IMU (MPU6050) для отслеживания ориентации и движения, мониторинг питания (INA226).
- **Управление**: Два DC-моторами с PWM для регулирования скорости и сервопривод для руления.
- **Связь**: MQTT поверх Wi-Fi для телеметрии и команд.
- **Настройка**: Легкая настройка через WiFi captive-портал.

## Установка
1. Установите [PlatformIO](https://platformio.org/) (или VS Code с расширением PlatformIO).
2. Клонируйте репозиторий `git clone https:\\github.com\wheelbot-org\wheelbot-ctrl.git`.
3. Соберите проект `cd wheelbot-ctrl && pio run`.
4. Прошейте на ESP8266: Подключите по USB, выполните `pio run -t erase && pio run -t upload && pio run -t uploadfs`.

### Требования
- Плата ESP8266 NodeMCU v2.
- Сенсоры: HC-SR04 (x2), MPU6050, INA226.
- Актуаторы: DC-моторы (x2), сервомотор.
- Библиотеки: Автоматически устанавливаются через PlatformIO (см. `platformio.ini`).

## Использование
1. Включите питание; если нет настроек WiFi, подключитесь к сети "Wheelbot-Ctrl-Setup" и настройте SSID/пароль через портал.
2. Робот подключится к WiFi/MQTT и опубликует данные сенсоров (например, `/sensors/json`).
3. Отправляйте команды MQTT для управления моторами/рулем (например, JSON-пейлоады для скорости/направления).
4. Мониторьте через последовательный порт (115200 бод) или подписки MQTT.

### Примеры MQTT payload'ов
- **Данные от сенсоров**: `{"sonars":{"left":50,"right":60},"accelerometr":{"x":0.1,"y":0,"z":9.8},...}`
- **Данные от подсистемы управление**: `{"engines":{"left":{"speed":100},"right":{"speed":100}},"steering":{"direction":45}}`

## MQTT команды
| Название команды | Топик | Payload | Описание |
|------------------|-------|---------|----------|
| Каллибровка IMU | `service/calibrate-mcu` | Игнорируется | Запускает каллибровку MPU6050, публикует offsets в `service/calibrate-mcu-result`. |
| Перезапуск | `service/restart` | Игнорируется | Перезапускает устройство. |
| Скорость левого мотора | `engines/left/speed_percent` | `int (-100..100)` | Устанавливает скорость левого мотора в процентах (отриц. — назад). |
| Скорость правого мотора | `engines/right/speed_percent` | `int (-100..100)` | Устанавливает скорость правого мотора в процентах. |
| Ускорение левого мотора | `engines/left/acceleration` | `int` | Устанавливает ускорение левого мотора. |
| Ускорение правого мотора | `engines/right/acceleration` | `int` | Устанавливает ускорение правого мотора. |
| Поворот руля | `steering-wheel/rotate` | `int (0..180)` | Устанавливает угол руля в градусах. |
| Ускорение руля | `steering-wheel/acceleration` | `int` | Устанавливает ускорение руля. |

## Разработка
- Мониторинг: `pio device monitor` для вывода на последовательный порт.
- Отладка: Включите `#define ENABLE_DEBUG` в `config.h`.
- Проверка: `pio check` для статического анализа.

## Commits
Вклады приветствуются! Форкните, внесите изменения и отправьте merge request.

## Авторы и благодарности
- Разработано командой WheelBot.org.
- Благодарность открытым библиотекам (NewPing, EspMQTTClient).

## Лицензия
Двойная лицензия:
- [**Не-коммерческая лицензия**](./LICENSE-NC): Бесплатно для личного, образовательного и исследовательского использования.
- [**Коммерческая лицензия**](./LICENSE-COMMERCIAL): Требуется для любого коммерческого использования. Свяжитесь: <iliya@bykonya.com>